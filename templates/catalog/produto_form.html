{% extends "base_app.html" %}
{% load static %}
{% block title %}{{ form.instance.pk|yesno:"Editar produto,Novo produto" }}{% endblock %}

{% block content %}
<div class="container">
  <div class="card">
    <div class="card-title">{{ form.instance.pk|yesno:"Editar produto,Novo produto" }}</div>

    {% if form.errors %}
      <div class="alert error" role="alert">Revise os campos destacados.</div>
    {% endif %}

    <nav class="tabs" role="tablist" aria-label="Abas do produto">
      <button type="button" class="tab is-active" role="tab" aria-selected="true" tabindex="0" data-tab="pedido">Pedido</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="bling">Bling</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="os">OS</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="manufatura">Manufatura</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="material">Material</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="grade">Grade</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="av-oficina">Aviamentos Oficina</button>
      <button type="button" class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="av-acab">Aviamentos Acabamento</button>
    </nav>

    <form method="post" id="produto-form" class="form">
      {% csrf_token %}
      {{ form.non_field_errors }}
      {{ form.form_uid }} {# UID auto único #}

      <div class="tab-panels" id="produto-tab-panels">
        <!-- ========== ABA: PEDIDO ========== -->
        <section class="tab-panel is-active" role="tabpanel" data-tab="pedido">
          <div class="grid">
            <div>{{ form.pedido_requisitante.label_tag }} {{ form.pedido_requisitante }}</div>
            <div>{{ form.pedido_cliente.label_tag }} {{ form.pedido_cliente }}</div>
            <div>{{ form.pedido_status.label_tag }} {{ form.pedido_status }}</div>
          </div>

          <div class="mt-3">
            <a class="dynamic-add" data-add="#pedido-extra" data-template="#tpl-pedido-extra">+ inserir campo</a>
            <div id="pedido-extra" class="dynamic-list"></div>
            <template id="tpl-pedido-extra">
              <div class="dynamic-row" data-row>
                <input type="text" name="pedido_extra_key___idx__" placeholder="Nome do campo">
                <input type="text" name="pedido_extra_val___idx__" placeholder="Valor">
              </div>
            </template>
          </div>
        </section>

        <!-- ========== ABA: BLING (model fields) ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="bling" hidden>
          <div class="grid">
            <div>{{ form.external_id.label_tag }} {{ form.external_id }}</div>
            <div>{{ form.sku.label_tag }} {{ form.sku }}</div>
            <div class="col-span-2">{{ form.name.label_tag }} {{ form.name }}</div>

            <div>{{ form.unit.label_tag }} {{ form.unit }}</div>
            <div>{{ form.origin.label_tag }} {{ form.origin }}</div>
            <div>{{ form.status.label_tag }} {{ form.status }}</div>
            <div>{{ form.is_active.label_tag }} {{ form.is_active }}</div>

            <div>{{ form.price.label_tag }} {{ form.price }}</div>
            <div>{{ form.cost_price.label_tag }} {{ form.cost_price }}</div>
            <div>{{ form.purchase_price.label_tag }} {{ form.purchase_price }}</div>
            <div>{{ form.stock_qty.label_tag }} {{ form.stock_qty }}</div>

            <div>{{ form.ncm.label_tag }} {{ form.ncm }}</div>
            <div>{{ form.cest.label_tag }} {{ form.cest }}</div>
            <div>{{ form.ipi_fixed.label_tag }} {{ form.ipi_fixed }}</div>
            <div>{{ form.icms_st_base_retencao.label_tag }} {{ form.icms_st_base_retencao }}</div>
            <div>{{ form.icms_st_valor_retencao.label_tag }} {{ form.icms_st_valor_retencao }}</div>
            <div>{{ form.icms_proprio_substituto.label_tag }} {{ form.icms_proprio_substituto }}</div>
            <div>{{ form.gtin.label_tag }} {{ form.gtin }}</div>
            <div>{{ form.fci_number.label_tag }} {{ form.fci_number }}</div>
            <div>{{ form.clone_from_parent.label_tag }} {{ form.clone_from_parent }}</div>
            <div>{{ form.free_shipping.label_tag }} {{ form.free_shipping }}</div>

            <div>{{ form.width_cm.label_tag }} {{ form.width_cm }}</div>
            <div>{{ form.height_cm.label_tag }} {{ form.height_cm }}</div>
            <div>{{ form.length_cm.label_tag }} {{ form.length_cm }}</div>
            <div>{{ form.weight_net.label_tag }} {{ form.weight_net }}</div>
            <div>{{ form.weight_gross.label_tag }} {{ form.weight_gross }}</div>

            <div>{{ form.product_category.label_tag }} {{ form.product_category }}</div>
            <div>{{ form.department.label_tag }} {{ form.department }}</div>
            <div>{{ form.brand.label_tag }} {{ form.brand }}</div>
            <div>{{ form.unit_of_measure.label_tag }} {{ form.unit_of_measure }}</div>

            <div class="col-span-2">{{ form.external_link.label_tag }} {{ form.external_link }}</div>
            <div class="col-span-2">{{ form.video_url.label_tag }} {{ form.video_url }}</div>
            <div>{{ form.warranty_months_supplier.label_tag }} {{ form.warranty_months_supplier }}</div>
            <div>{{ form.product_condition.label_tag }} {{ form.product_condition }}</div>

            <div class="col-span-2">{{ form.notes.label_tag }} {{ form.notes }}</div>
            <div class="col-span-2">{{ form.extra_info.label_tag }} {{ form.extra_info }}</div>
            <div class="col-span-2">{{ form.bling_extra.label_tag }} {{ form.bling_extra }}</div>

            <div>{{ form.supplier_code.label_tag }} {{ form.supplier_code }}</div>
            <div>{{ form.supplier_name.label_tag }} {{ form.supplier_name }}</div>
            <div class="col-span-2">{{ form.location.label_tag }} {{ form.location }}</div>
          </div>

          <div class="mt-3">
            <a class="dynamic-add" data-add="#bling-extra" data-template="#tpl-bling-extra">+ inserir campo</a>
            <div id="bling-extra" class="dynamic-list"></div>
            <template id="tpl-bling-extra">
              <div class="dynamic-row" data-row>
                <input type="text" name="bling_extra_key___idx__" placeholder="Nome do campo">
                <input type="text" name="bling_extra_val___idx__" placeholder="Valor">
              </div>
            </template>
          </div>
        </section>

        <!-- ========== ABA: OS ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="os" hidden>
          <div class="grid">
            <div>{{ form.os_estilo.label_tag }} {{ form.os_estilo }}</div>
            <div>{{ form.os_arte.label_tag }} {{ form.os_arte }}</div>
            <div>{{ form.os_modelagem.label_tag }} {{ form.os_modelagem }}</div>
            <div>{{ form.os_pilotagem.label_tag }} {{ form.os_pilotagem }}</div>
            <div>{{ form.os_encaixe.label_tag }} {{ form.os_encaixe }}</div>
          </div>
          <div class="mt-3">
            <a class="dynamic-add" data-add="#os-extra" data-template="#tpl-os-extra">+ inserir campo</a>
            <div id="os-extra" class="dynamic-list"></div>
            <template id="tpl-os-extra">
              <div class="dynamic-row" data-row>
                <input type="text" name="os_extra_key___idx__" placeholder="Nome do campo">
                <input type="text" name="os_extra_val___idx__" placeholder="Valor">
              </div>
            </template>
          </div>
        </section>

        <!-- ========== ABA: MANUFATURA ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="manufatura" hidden>
          <div class="grid">
            <div>{{ form.m_corte.label_tag }} {{ form.m_corte }}</div>
            <div>{{ form.m_costura.label_tag }} {{ form.m_costura }}</div>
            <div>{{ form.m_estamparia.label_tag }} {{ form.m_estamparia }}</div>
            <div>{{ form.m_bordado.label_tag }} {{ form.m_bordado }}</div>
            <div>{{ form.m_lavanderia.label_tag }} {{ form.m_lavanderia }}</div>
            <div>{{ form.m_acabamento.label_tag }} {{ form.m_acabamento }}</div>
          </div>
          <div class="mt-3">
            <a class="dynamic-add" data-add="#manu-extra" data-template="#tpl-manu-extra">+ inserir campo</a>
            <div id="manu-extra" class="dynamic-list"></div>
            <template id="tpl-manu-extra">
              <div class="dynamic-row" data-row>
                <input type="text" name="manu_extra_key___idx__" placeholder="Nome do campo">
                <input type="text" name="manu_extra_val___idx__" placeholder="Valor">
              </div>
            </template>
          </div>
        </section>

        <!-- ========== ABA: MATERIAL ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="material" hidden>
          <div class="grid">
            <div class="col-span-2">{{ form.material_tecido_1.label_tag }} {{ form.material_tecido_1 }}</div>
          </div>
          <div class="mt-3">
            <a class="dynamic-add" data-add="#material-list" data-template="#tpl-material-row">+ inserir campo</a>
            <div id="material-list" class="dynamic-list"></div>
            <template id="tpl-material-row">
              <div class="dynamic-row" data-row>
                <input type="text" name="material_tecido___idx__" placeholder="Tecido">
                <input type="text" name="material_obs___idx__" placeholder="Observação">
              </div>
            </template>
          </div>
        </section>

        <!-- ========== ABA: GRADE ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="grade" hidden>
          <div class="mb-4">Linha de cabeçalho de tamanhos. Você pode adicionar colunas e linhas.</div>

          <div class="grid">
            <div class="col-span-2">
              <div class="dynamic-list" id="grade-head">
                <div class="dynamic-row" data-row>
                  <input type="text" name="grade_col_1" placeholder="P">
                  <input type="text" name="grade_col_2" placeholder="M">
                  <input type="text" name="grade_col_3" placeholder="G">
                  <input type="text" name="grade_col_4" placeholder="GG">
                </div>
              </div>
              <a class="dynamic-add" data-add="#grade-head" data-template="#tpl-grade-col">+ inserir coluna</a>
              <template id="tpl-grade-col">
                <div class="dynamic-row" data-row>
                  <input type="text" name="grade_col___idx__" placeholder="Novo tamanho">
                </div>
              </template>
            </div>

            <div class="col-span-2 mt-3">
              <div id="grade-body" class="dynamic-list"></div>
              <a class="dynamic-add" data-add="#grade-body" data-template="#tpl-grade-row">+ inserir linha</a>
              <template id="tpl-grade-row">
                <div class="dynamic-row" data-row>
                  <input type="text" name="grade_cor___idx__" placeholder="Cor (ex.: Preto)">
                  <input type="text" name="grade_vals___idx__" placeholder="Quantidades (ex.: 10 10 10 11)">
                </div>
              </template>
            </div>
          </div>
        </section>

        <!-- ========== ABA: AVIAMENTOS OFICINA ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="av-oficina" hidden>
          <div class="grid">
            <div class="col-span-2">{{ form.av_oficina_linha_1.label_tag }} {{ form.av_oficina_linha_1 }}</div>
          </div>
          <div class="mt-3">
            <a class="dynamic-add" data-add="#av-oficina-list" data-template="#tpl-av-oficina-row">+ inserir campo</a>
            <div id="av-oficina-list" class="dynamic-list"></div>
            <template id="tpl-av-oficina-row">
              <div class="dynamic-row" data-row>
                <input type="text" name="av_oficina_item___idx__" placeholder="Item (ex.: Linha 120 Tex)">
                <input type="text" name="av_oficina_qtd___idx__" placeholder="Qtd/Obs">
              </div>
            </template>
          </div>
        </section>

        <!-- ========== ABA: AVIAMENTOS ACABAMENTO ========== -->
        <section class="tab-panel" role="tabpanel" data-tab="av-acab" hidden>
          <div class="grid">
            <div>{{ form.avacab_sacola.label_tag }} {{ form.avacab_sacola }}</div>
            <div>{{ form.avacab_tag.label_tag }} {{ form.avacab_tag }}</div>
          </div>
          <div class="mt-3">
            <a class="dynamic-add" data-add="#av-acab-list" data-template="#tpl-av-acab-row">+ inserir campo</a>
            <div id="av-acab-list" class="dynamic-list"></div>
            <template id="tpl-av-acab-row">
              <div class="dynamic-row" data-row>
                <input type="text" name="av_acab_item___idx__" placeholder="Item (ex.: Etiqueta borracha)">
                <input type="text" name="av_acab_qtd___idx__" placeholder="Qtd/Obs">
              </div>
            </template>
          </div>
        </section>
      </div>

      <div class="form-actions">
        <button class="btn" type="submit">Salvar</button>
        <a class="btn secondary" href="{% url 'catalog:produto_list' %}">Cancelar</a>
      </div>
    </form>
  </div>
</div>

<script src="{% static 'crontex/js/produto_form_tabs.js' %}"></script>
{% endblock %}
