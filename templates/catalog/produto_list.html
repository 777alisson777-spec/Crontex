{% extends "base_app.html" %}
{% block title %}Produtos{% endblock %}
{% block content %}

<section class="kpi" style="padding:16px">
  <form method="get" style="display:grid; grid-template-columns:1fr 160px 160px; gap:12px">
    <div class="input">
      <span class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M15.5 14h-.8l-.3-.3a6.5 6.5 0 1 0-.9.9l.3.3v.8L20 21.5 21.5 20l-6-6ZM10 15a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/></svg>
      </span>
      <input type="search" name="q" value="{{ request.GET.q }}" placeholder="Buscar por nome ou SKU">
    </div>
    <div class="input">
      <select name="status">
        <option value="">Todos</option>
        <option value="ativos" {% if request.GET.status == 'ativos' %}selected{% endif %}>Ativos</option>
        <option value="inativos" {% if request.GET.status == 'inativos' %}selected{% endif %}>Inativos</option>
      </select>
    </div>
    <button class="btn btn-lg" type="submit">Filtrar</button>
  </form>
  <div style="margin-top:12px; display:flex; justify-content:flex-end">
    <a class="btn" href="{% url 'catalog:produto_create' %}" style="height:var(--control-h); display:inline-flex; align-items:center; padding:0 16px">Novo produto</a>
  </div>
</section>

<div class="kpi-grid" style="margin-top:16px">
  {% for p in object_list %}
  <article class="kpi" style="padding:14px; display:flex; gap:12px; align-items:center">
    <div style="width:72px; height:72px; border:1px solid var(--c-line); border-radius:12px; overflow:hidden; background:#fff">
      {% if p.imagem %}<img src="{{ p.imagem.url }}" alt="{{ p.nome }}" style="width:100%; height:100%; object-fit:cover">{% endif %}
    </div>
    <div style="flex:1; min-width:0">
      <div class="value" style="font-size:18px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis">{{ p.nome }}</div>
      <div class="muted" style="font-size:12px">SKU {{ p.sku }} • Estoque {{ p.estoque }} • R$ {{ p.preco }}</div>
      <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
        <a class="side-link" href="{% url 'catalog:produto_detail' p.pk %}">Abrir</a>
        <a class="side-link" href="{% url 'catalog:produto_update' p.pk %}">Editar</a>
        <a class="side-link" href="{% url 'catalog:produto_delete' p.pk %}">Excluir</a>
        {% if p.ativo %}<span class="status ok">Ativo</span>{% else %}<span class="status blocked">Inativo</span>{% endif %}
      </div>
    </div>
  </article>
  {% empty %}
    <section class="kpi" style="padding:16px">Nenhum produto encontrado.</section>
  {% endfor %}
</div>

{% if is_paginated %}
  <section style="margin-top:16px; display:flex; gap:8px; align-items:center">
    {% if page_obj.has_previous %}
      <a class="side-link" href="?{% if request.GET.q %}q={{request.GET.q}}&{% endif %}{% if request.GET.status %}status={{request.GET.status}}&{% endif %}page={{ page_obj.previous_page_number }}">« Anterior</a>
    {% endif %}
    <span class="muted">Página {{ page_obj.number }} de {{ paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="side-link" href="?{% if request.GET.q %}q={{request.GET.q}}&{% endif %}{% if request.GET.status %}status={{request.GET.status}}&{% endif %}page={{ page_obj.next_page_number }}">Próxima »</a>
    {% endif %}
  </section>
{% endif %}
{% endblock %}
